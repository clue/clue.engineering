<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introducing HTTP CONNECT proxy connector for ReactPHP</title>
    <link href="../src/landing-page.v2.css" rel="stylesheet">
    <link href="../src/tailwind.min.css" rel="stylesheet">
    <link rel="alternate" type="application/atom+xml" href="../posts.atom" title="Recent blog posts" />
    <script defer data-domain="clue.engineering" src="https://plausible.io/js/script.outbound-links.js"></script>

    <meta name="description" content="Today, I&#039;m happy to announce the v1.4.0 release of clue/reactphp-http-proxy, the async HTTP proxy connector, use any TCP/IP-based protocol through an HTTP CONNECT proxy server, built on top of ReactPHP. ðŸŽ‰  Once again, the version number and its release history suggests this is not exactly a new project. Inâ€¦">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Introducing HTTP CONNECT proxy connector for ReactPHP">
    <meta property="og:description" content="Today, I&#039;m happy to announce the v1.4.0 release of clue/reactphp-http-proxy, the async HTTP proxy connector, use any TCP/IP-based protocol through an HTTP CONNECT proxy server, built on top of ReactPHP. ðŸŽ‰  Once again, the version number and its release history suggests this is not exactly a new project. Inâ€¦">
    <meta property="og:url" content="https://clue.engineering/2018/introducing-reactphp-http-proxy">
    <meta property="og:site_name" content="clueÂ·engineering">
    <meta property="article:published_time" content="2018-10-30">
    <meta name="twitter:site" content="@another_clue">
    <meta name="twitter:creator" content="@another_clue">
</head>

<body>
    <header class="bg-gray-800">
      <div class="relative">
        <div class="flex justify-between items-center max-w-3xl mx-auto px-1 py-1">
          <div class="flex justify-start">
            <a href="../" class="text-white py-1 px-1 hover:text-blue-100">
              <strong>clue</strong>Â·engineering
            </a>
          </div>
          
          <nav class="flex justify-end items-center space-x-1 sm:space-x-8">
            <a href="../blog" class="text-base text-gray-300 hover:text-gray-200">
              Blog
            </a>
            <a href="../talks" class="text-base text-gray-300 hover:text-gray-200">
              Talks
            </a>
            <a href="../support" class="ml-8 whitespace-nowrap inline-flex items-center justify-center px-1 sm:px-4 py-1 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-blue-500 hover:bg-blue-400">
              <span class="hidden sm:inline sm:mr-1">Professional</span> Services
            </a>
          </nav>
        </div>
      </div>
    </header>

    <section id="post">
        <div class="container">
            <article>
                <h1>Introducing HTTP CONNECT proxy connector for ReactPHP</h1>
                <div>
                    <address>
                        <img src="../src/me.jpg" alt="Christian LÃ¼ck Portrait Photo">
                        <a href="../">Christian LÃ¼ck</a>
                    </address>
                    on <time datetime="2018-10-30">2018-10-30</time>
                    <div>
                        tagged
                        <a href="../blog#introducing-reactphp" title="Show all blog posts tagged #introducing-reactphp" rel="tag">#introducing-reactphp</a>
                        <a href="../blog#reactphp" title="Show all blog posts tagged #reactphp" rel="tag">#reactphp</a>
                        <a href="../blog#release" title="Show all blog posts tagged #release" rel="tag">#release</a>
                        <a href="../blog#http" title="Show all blog posts tagged #http" rel="tag">#http</a>
                        <a href="../blog#proxy" title="Show all blog posts tagged #proxy" rel="tag">#proxy</a>
                    </div>
                </div>

<p>Today, I'm happy to announce the <code>v1.4.0</code> release of <a href="https://github.com/clue/reactphp-http-proxy">clue/reactphp-http-proxy</a>,
the async HTTP proxy connector, use any TCP/IP-based protocol through an HTTP CONNECT proxy server, built on top of <a href="https://reactphp.org/">ReactPHP</a>. ðŸŽ‰</p>

<p>Once again, the version number and its <a href="https://github.com/clue/reactphp-http-proxy/releases">release history</a> suggests this is not exactly a new project. In fact, this has been used in production in a number of projects for a couple of years already. So I guess it's about time to write an introductory blog post about this project, what HTTP CONNECT proxy servers can be used for and why I think ReactPHP's design makes it a perfect fit.</p>

<h2 id="http-connect">HTTP CONNECT</h2>

<p>HTTP CONNECT proxy servers (also commonly known as "HTTPS proxy" or "SSL proxy") are commonly used to tunnel HTTPS traffic through an intermediary ("proxy"), to conceal the origin address (anonymity) or to circumvent address blocking (geoblocking). While many (public) HTTP CONNECT proxy servers often limit this to HTTPS port <code>443</code> only, this can technically be used to tunnel any TCP/IP-based protocol (HTTP, SMTP, IMAP etc.).</p>

<p><a href="https://github.com/clue/reactphp-http-proxy">clue/reactphp-http-proxy</a> provides a simple API to create these tunneled connections for you. Because it implements ReactPHP's standard <code>ConnectorInterface</code>, it can simply be used in place of a normal connector. This makes it fairly simple to add HTTP CONNECT proxy support to pretty much any existing higher-level protocol implementation.</p>

<h2 id="proxy-http-requests">Proxy HTTP requests</h2>

<blockquote>
  <p>I'm probably not telling you something new when I say the web is built on top of HTTP. This blog post is served over HTTP. Your YouTube videos are served over HTTP. Your downloads are served over HTTP. RESTful backend APIs are served over HTTP. GraphQL APIs are served over HTTP. SOAP APIs are served over HTTP. Yes, I may be oversimplifying things a bit here, but I think you get the point.</p>
  
  <p>â€“ From my last week's blog post <a href="https://clue.engineering/2018/introducing-reactphp-buzz">introducing async HTTP requests with ReactPHP</a>.</p>
</blockquote>

<p>With HTTP being so ubiquitous, it's no surprise that using a proxy server for HTTP requests is one of the more common requirements when using proxy servers. To recap, let's first take a look at how to send an HTTP request with ReactPHP, again from the <a href="https://clue.engineering/2018/introducing-reactphp-buzz">previous blog post</a>:</p>

<pre><code class="php">$loop = \React\EventLoop\Factory::create();
$client = new \Clue\React\Buzz\Browser($loop);

$client-&gt;get('https://api.example.com/')-&gt;then(function (ResponseInterface $response) {
    var_dump($response-&gt;getHeaders(), (string)$response-&gt;getBody());
});

$loop-&gt;run();
</code></pre>

<p>This example makes no mention of any proxy setup and thus sends a <code>GET</code> request over a direct connection to the destination host. If you want to proxy the same HTTP request through an HTTP CONNECT proxy server, you only have to add a few extra lines of code. After installing the HTTP CONNECT proxy support with <code>composer require clue/http-proxy-react:^1.4</code>, the same example could look something like this:</p>

<pre><code class="php">$loop = \React\EventLoop\Factory::create();

$proxy = new ProxyConnector('http://127.0.0.1:8080', new Connector($loop));
$connector = new Connector($loop, array(
    'tcp' =&gt; $proxy,
    'dns' =&gt; false
));

$client = new \Clue\React\Buzz\Browser($loop, $connector);

$client-&gt;get('https://api.example.com/')-&gt;then(function (ResponseInterface $response) {
    var_dump($response-&gt;getHeaders(), (string)$response-&gt;getBody());
});

$loop-&gt;run();
</code></pre>

<p>For this to work, you'll need to have a proxy server listening on <code>127.0.0.1:8080</code>. If you're not already running a proxy server, you can simply download and run <a href="https://leproxy.org">LeProxy</a> (no installation or configuration required). As an alternative, you can also use your favorite search engine to search for free HTTPS proxy servers (which are often of mixed quality) or use your favorite paid proxy subscription plan and adjust the example to use the appropriate proxy address.</p>

<p>Now what does all of this code mean? Admittedly, the few extra lines of code added near the top may look a bit confusing at first, so let's ignore this for a moment. Interestingly, what has <em>not</em> changed is any of the code that actually sends the HTTP requests. In fact, if you go take a look at the internals of this <a href="https://github.com/clue/reactphp-buzz">HTTP client</a>, you'll find that all of this works without having even a single line of code internally dedicated to proxy server support.</p>

<p>Now what does this code actually do? The few extra lines of code added near the top specifically change the way the HTTP client creates a connection to the destination host. Instead of using the default <code>Connector</code> to create a direct connection to the host, we create an explicit <code>Connector</code> which uses the proxy server to create the connection to the destination host. What this means is that the HTTP client doesn't really require any changes, it only requires a special <code>Connector</code> which somehow creates this connection to the destination. What the <code>ProxyConnector</code> does internally, is it creates a connection to the proxy server, uses the HTTP CONNECT proxy protocol to ask the proxy to create a connection to the destination host and then returns this connection once it's ready.</p>

<h2 id="tunnel-any-protocol%21">Tunnel any protocol!</h2>

<p>In the previous chapter we've seen how this project can be used to send HTTP requests through an HTTP CONNECT proxy server. Likewise, we can use this to tunnel any tool/protocol that builds on top of HTTP over an HTTP CONNECT proxy server, whether it's your favorite RESTful HTTP API, GraphQL API or even SOAP.</p>

<p>But what about other protocols? If you look closely at the previous example, you'll see that nothing of what we've discussed so far is really limited to HTTP at all. In fact, if you look a bit closer at the previous example, you'll see that it already uses HTTPS (secure HTTP over TLS) instead of plain HTTP. What this means is that HTTP CONNECT proxy servers do not really care what kind of (payload) protocol you send over this tunneled connection. While many (public) HTTP CONNECT proxy servers often limit this to HTTPS port <code>443</code> only, this can technically be used to tunnel any TCP/IP-based protocol (HTTP, SMTP, IMAP etc.).</p>

<p><a href="https://github.com/reactphp/react/wiki/Users">ReactPHP's vast ecosystem</a> features a large number of existing client implementations for pretty much any widespread protocol and database system out there. Any project that builds on top of ReactPHP's components will in one way or another use a <code>Connector</code> to create its underlying connection to its destination host. Accordingly, if you go take a look at their documentation, you'll find that pretty much all of them expose an optional <code>Connector</code> instance somehow. Among others, this allows us to pass an explicit proxy connector like in the previous example. For example, this allows us to create a MySQL or Redis database connection over an HTTP CONNECT proxy server.</p>

<h2 id="conclusions">Conclusions</h2>

<p>HTTP CONNECT proxy servers are commonly used to tunnel HTTPS traffic through an intermediary ("proxy"), to conceal the origin address (anonymity) or to circumvent address blocking (geoblocking). Likewise, we can use this to tunnel any TCP/IP-based protocol. Thanks to ReactPHP's component-based design, we can add HTTP CONNECT proxy server support to pretty much any existing higher-level implementation with ease, whether it's a common HTTP client implementation or some obscure binary protocol.</p>

<p>If you want to learn more about this project, make sure to check out the project homepage of <a href="https://github.com/clue/reactphp-http-proxy">clue/reactphp-http-proxy</a>. Its documentation describes common usage patterns as well as all the nifty details. It is considered stable and feature complete and has been used in production for a couple of years already, so you're invited to also give it a try! If you like this project, spreading the word is much appreciated! If you have any feedback or just want to reach out and say hello, I'm happy to hear back and appreciate feedback! Use the contact options in the section below and let's get in touch.</p>

<blockquote class="twitter-tweet" data-lang="de"><p lang="en" dir="ltr">Just released clue/reactphp-http-proxy v1.4.0! ðŸŽ‰ It allows you to tunnel HTTP requests or really any TCP/IP-based protocol over an HTTP CONNECT proxy server with plain PHP. Efficiently process large number of HTTP requests with <a href="https://twitter.com/reactphp?ref_src=twsrc%5Etfw">@ReactPHP</a>. <a href="https://twitter.com/hashtag/async?src=hash&amp;ref_src=twsrc%5Etfw">#async</a> <a href="https://twitter.com/hashtag/php?src=hash&amp;ref_src=twsrc%5Etfw">#php</a> <a href="https://t.co/rucOHv72MR">https://t.co/rucOHv72MR</a></p>&mdash; Christian LÃ¼ck (@another_clue) <a href="https://twitter.com/another_clue/status/1057317495969845250?ref_src=twsrc%5Etfw">30. Oktober 2018</a></blockquote>
            </article>
        </div>
    </section>

    <section id="calendly">
        <div class="bg-white">
            <div class="max-w-5xl mx-auto py-16 px-4 sm:px-6 lg:px-8">
                <div class="bg-gray-800 rounded-lg shadow-xl overflow-hidden lg:grid lg:grid-cols-2 lg:gap-4">
                    <div class="pt-10 pb-12 px-6 sm:pt-16 sm:px-16 lg:py-16 lg:pr-0 xl:py-10 xl:px-10">
                        <div class="lg:self-center">
                            <h2 class="text-3xl font-extrabold text-white sm:text-4xl">
                                <span class="block">We're Here to Help!</span>
                                <span class="block text-blue-400">Let's Tackle Your Problems Together.</span>
                            </h2>
                            <p class="mt-4 text-lg leading-6 text-gray-200">
                                Did you know we provide <a href="https://clue.engineering/support" class="underline">professional support</a> for software projects?
                                Book an appointment, you pay absolutely nothing for the first consultation.
                            </p>
                            <a href="https://calendly.com/clue-engineering/getting-started" class="mt-8 bg-blue-400 hover:bg-blue-500 border border-transparent rounded-md shadow px-5 py-3 inline-flex items-center text-base font-medium text-white">Set Up a Free Call</a>
                        </div>
                    </div>
                    <div class="-mt-6 aspect-w-5 aspect-h-3 md:aspect-w-2 md:aspect-h-1">
                        <a href="https://calendly.com/clue-engineering/getting-started">
                            <img class="transform translate-x-16 translate-y-6 rounded-md object-cover object-left-top sm:translate-x-24 lg:translate-y-24 lg:translate-x-16" src="../src/2023-calendly.png" alt="calendly screenshot">
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="share">
        <div class="container">
            <h3>
                <a href="#share"></a>
                We love feedback!
            </h3>
            <p>
                If you have anything to add,
                send a tweet to <a href="https://twitter.com/another_clue">@another_clue</a>.
            </p>
            <p>
                We invite you to share our blog posts with friends and colleagues.
                All our blog posts can be shared freely under the permissive
                <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY</a>
                license.
            </p>
            <p>
                <!-- Thank you! https://fontawesome.com/ (solid/envelope) -->
                <svg viewBox="0 0 512 512"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg>
                <a href="../contact">Email us</a> if you think we should be working together on interesting projects.
            </p>
        </div>
    </section>

    <footer class="bg-gray-800">
      <div class="max-w-7xl mx-auto py-12 px-4 overflow-hidden sm:px-6 lg:px-8">
        <nav class="-mx-5 -my-2 flex flex-wrap justify-center" aria-label="Footer">
          <div class="px-5 py-2">
            <a href="../" class="text-base text-gray-400 hover:text-gray-300">
              Home
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="../support" class="text-base text-gray-400 hover:text-gray-300">
              Services
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="../blog" class="text-base text-gray-400 hover:text-gray-300">
              Blog
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="../talks" class="text-base text-gray-400 hover:text-gray-300">
              Talks
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="../contact" class="text-base text-gray-400 hover:text-gray-300">
              Contact
            </a>
          </div>


          <div class="px-5 py-2">
            <a href="../contact#imprint" class="text-base text-gray-400 hover:text-gray-300">
              Imprint
            </a>
          </div>
        </nav>
        <div class="mt-8 flex justify-center space-x-6">
          <a href="https://twitter.com/another_clue" title="@another_clue on Twitter" class="text-gray-400 hover:text-gray-300">
            <span class="sr-only">Twitter</span>
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" />
            </svg>
          </a>
    
          <a href="https://github.com/clue" title="@clue on GitHub" class="text-gray-400 hover:text-gray-300">
            <span class="sr-only">GitHub</span>
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
            </svg>
          </a>
        </div>
      </div>
    </footer>
</body>
</html>
