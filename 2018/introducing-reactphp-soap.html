<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introducing async SOAP requests with ReactPHP</title>
    <link href="../src/landing-page.v2.css" rel="stylesheet">
    <link href="../src/tailwind.min.css" rel="stylesheet">
    <link rel="alternate" type="application/atom+xml" href="../posts.atom" title="Recent blog posts" />
    <script defer data-domain="clue.engineering" src="https://plausible.io/js/script.outbound-links.js"></script>

    <meta name="description" content="Today, I&#039;m happy to announce the v1.0.0 release of clue/reactphp-soap, the simple, async SOAP web service client library, built on top of ReactPHP. ðŸŽ‰  To answer the first thing you may be wondering: Yes, it is 2018 and indeed, this project has been used in production in a numberâ€¦">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Introducing async SOAP requests with ReactPHP">
    <meta property="og:description" content="Today, I&#039;m happy to announce the v1.0.0 release of clue/reactphp-soap, the simple, async SOAP web service client library, built on top of ReactPHP. ðŸŽ‰  To answer the first thing you may be wondering: Yes, it is 2018 and indeed, this project has been used in production in a numberâ€¦">
    <meta property="og:url" content="https://clue.engineering/2018/introducing-reactphp-soap">
    <meta property="og:site_name" content="clueÂ·engineering">
    <meta property="article:published_time" content="2018-11-07">
    <meta name="twitter:site" content="@another_clue">
    <meta name="twitter:creator" content="@another_clue">
</head>

<body>
    <header class="bg-gray-800">
      <div class="relative">
        <div class="flex justify-between items-center max-w-3xl mx-auto px-1 py-1">
          <div class="flex justify-start">
            <a href="../" class="text-white py-1 px-1 hover:text-blue-100">
              <strong>clue</strong>Â·engineering
            </a>
          </div>
          
          <nav class="flex justify-end items-center space-x-1 sm:space-x-8">
            <a href="../blog" class="text-base text-gray-300 hover:text-gray-200">
              Blog
            </a>
            <a href="../talks" class="text-base text-gray-300 hover:text-gray-200">
              Talks
            </a>
            <a href="../support" class="ml-8 whitespace-nowrap inline-flex items-center justify-center px-1 sm:px-4 py-1 border border-transparent rounded-md shadow-sm text-base font-medium text-white bg-blue-500 hover:bg-blue-400">
              <span class="hidden sm:inline sm:mr-1">Professional</span> Services
            </a>
          </nav>
        </div>
      </div>
    </header>

    <section id="post">
        <div class="container">
            <article>
                <h1>Introducing async SOAP requests with ReactPHP</h1>
                <div>
                    <address>
                        <img src="../src/me.jpg" alt="Christian LÃ¼ck Portrait Photo">
                        <a href="../">Christian LÃ¼ck</a>
                    </address>
                    on <time datetime="2018-11-07">2018-11-07</time>
                    <div>
                        tagged
                        <a href="../blog#introducing-reactphp" title="Show all blog posts tagged #introducing-reactphp" rel="tag">#introducing-reactphp</a>
                        <a href="../blog#reactphp" title="Show all blog posts tagged #reactphp" rel="tag">#reactphp</a>
                        <a href="../blog#release" title="Show all blog posts tagged #release" rel="tag">#release</a>
                        <a href="../blog#soap" title="Show all blog posts tagged #soap" rel="tag">#soap</a>
                        <a href="../blog#rpc" title="Show all blog posts tagged #rpc" rel="tag">#rpc</a>
                        <a href="../blog#http" title="Show all blog posts tagged #http" rel="tag">#http</a>
                    </div>
                </div>

<p>Today, I'm happy to announce the <code>v1.0.0</code> release of <a href="https://github.com/clue/reactphp-soap">clue/reactphp-soap</a>,
the simple, async <a href="https://en.wikipedia.org/wiki/SOAP">SOAP</a> web service client library, built on top of <a href="https://reactphp.org/">ReactPHP</a>. ðŸŽ‰</p>

<p>To answer the first thing you may be wondering: <em>Yes, it is 2018</em> and indeed, this project has been used in production in a number of projects for a few of years already. So I guess it's about time to write an introductory blog post about this project, how SOAP requests can be used and why I think ReactPHP's design makes it a perfect fit. Warning, terrible puns ahead.</p>

<blockquote>
  <p>Note you're viewing an outdated blog post for the version 1 release of this library.
    See our <a href="../2020/announcing-reactphp-soap-2">new version 2 release announcement</a> for the current version.</p>
</blockquote>

<h2 id="soap-shouldn%27t-make-you-feel-dirty">SOAP shouldn't make you feel dirty</h2>

<p>Most notably, SOAP is often used for invoking <a href="https://en.wikipedia.org/wiki/Remote_procedure_call">remote procedure calls</a> (RPCs) in distributed systems. Internally, SOAP messages are encoded as XML and usually sent via HTTP POST requests. Each SOAP web service may offer any number of RPC functions. These are usually defined in a public <a href="https://en.wikipedia.org/wiki/Web_Services_Description_Language">WSDL</a> file which contains definitions for all functions, their arguments and return values. For the most part, SOAP (originally <em>Simple Object Access protocol</em>) is a protocol of the past, and in fact anything but <em>simple</em>. It is still in use by many (often <em>legacy</em>) systems.</p>

<p>Nowadays, competing approaches could involve (RESTful) HTTP APIs, GraphQL and JSON-RPC, among others. I'm not going to argue that either approach would be best suited for your particular use-case, but I <em>will</em> argue that many SOAP APIs have clearly stood the test of time and continue to provide very real business value with little maintenance overhead. This remains something  the more modern approaches to API design have yet to prove. Arguably, while RPCs formatted as XML sent over HTTP are not exactly network-efficient, this is not really a major concern for many of the more <em>enterprisey</em> applications out there.</p>

<h2 id="async-soap-requests">Async SOAP requests</h2>

<p>Using SOAP with PHP is relatively straight-forward: Its <a href="https://www.php.net/manual/en/soapclient.soapclient.php"><code>SoapClient</code></a> provides everything you need on the client (calling) side. You can simply point this class to the URL of the WSDL file of your particular web service and can start calling functions right away. It takes care of marshalling (encoding) your function arguments to a SOAP message as defined in the WSDL file, sending it as an HTTP request, waiting for the response and unmarshalling (parsing) the SOAP response message and exposing the (parsed) return value.</p>

<p>While marshalling to XML and unmarshalling from XML may sound like a complex task, this is something that usually takes no more than a few microseconds. Sending HTTP requests is something that does take significantly more time, usually somewhere in the range of some hundred milliseconds to a few seconds. Fortunately, this is something that can easily be <a href="https://clue.engineering/2018/introducing-reactphp-buzz">performed asynchronously</a>.</p>

<p>This is where <a href="https://github.com/clue/reactphp-soap">clue/reactphp-soap</a> comes into play: By leveraging PHP's existing <a href="https://www.php.net/manual/en/soapclient.soapclient.php"><code>SoapClient</code></a> for (un)marshalling and combining it with the async HTTP client <a href="https://github.com/clue/reactphp-buzz">clue/reactphp-buzz</a>, we can provide a simple API to perform async SOAP requests. Without further ado, let's take a look at an example sending two concurrent SOAP requests:</p>

<pre><code class="php">$loop = \React\EventLoop\Factory::create();
$browser = new \Clue\React\Buzz\Browser($loop);
$wsdl = file_get_contents('service.wsdl');
$client = new \Clue\React\Soap\Client($browser, $wsdl);
$proxy = new \Clue\React\Soap\Proxy($client);

$proxy-&gt;demo(1, 2)-&gt;then(function ($result) {
    var_dump('first result', $result);
});

$proxy-&gt;demo(3, 4)-&gt;then(function ($result) {
    var_dump('second result', $result);
});

$loop-&gt;run();
</code></pre>

<p>Now what does all of this code mean? If you remember one of the <a href="https://clue.engineering/2018/introducing-reactphp-buzz">previous blog posts</a> you'll see some familiar boilerplate. Admittedly, if you've never worked with ReactPHP and async APIs in PHP before, the <code>$loop</code> boilerplate near the top may look a bit confusing at first, so let's ignore this for a moment.</p>

<p>If we focus on the <code>$proxy</code> part, we can see that this example will execute two method calls. These are our RPCs that will transparently be sent to the remote web service and allow us to react to the results of these calls, in this case dumping their results. What is worth noting, however, is how this is executed. Being entirely async, this piece of code will actually send two requests <em>concurrently</em>.</p>

<blockquote>
  <p><strong>1 + 1 = 1?</strong></p>
  
  <p>What this means, in a gist, is that if a single request takes 1 second to complete, then two requests will also take just 1 second (assuming ideal network conditions). By leveraging non-blocking I/O, actually sending the HTTP request over the wire and receiving the HTTP response takes close to zero seconds. Most of the time will only be spend <em>waiting</em> for the remote server to actually serve the request. This is not just some theoretical construct, but something that bears some very real real-world performance improvements.</p>
  
  <p>Depending mostly on what kind of load the receiving side is willing to accept, this approach scales very well to around a dozen or so concurrent requests. If you want to send a larger number of requests, you may want to take a look at one of the previous blog posts introducing an <a href="https://clue.engineering/2018/introducing-reactphp-mq">in-memory queue</a> or <a href="https://clue.engineering/2018/introducing-reactphp-flux">managing flux</a> to throttle your sending side to limit concurrency to whatever limit works best for your specific use case.</p>
  
  <p>â€“ dÃ©jÃ  vu from previous blog post <a href="https://clue.engineering/2018/introducing-reactphp-buzz">introducing async HTTP requests</a></p>
</blockquote>

<h2 id="conclusions">Conclusions</h2>

<p>I think we can all agree that soap exists for good reasons (<em>sorry</em>). SOAP may not be new and may not be pretty, but it's far from being dead and continues to be a common protocol when connecting to existing third-party APIs. This makes <a href="https://github.com/clue/reactphp-soap">clue/reactphp-soap</a> an important piece of the puzzle of bringing ReactPHP to the masses, in particular when it comes to some of the more <em>enterprisey</em> APIs that offer very real business value. Thanks to ReactPHP's component-based design and its existing ecosystem, we can leverage its efficient network protocols to concurrently process a large number of requests, <a href="https://clue.engineering/2018/introducing-reactphp-mq">throttle concurrency</a>, <a href="https://clue.engineering/2018/introducing-reactphp-http-proxy">use HTTP proxy servers</a> and much more.</p>

<p>If you want to learn more about this project, make sure to check out the project homepage of <a href="https://github.com/clue/reactphp-soap">clue/reactphp-soap</a>. Its documentation describes common usage patterns as well as all the nifty details. It is considered stable and feature complete and has been used in production for a few years already, so you're invited to also give it a try! If you like this project, spreading the word is much appreciated! If you have any feedback or just want to reach out and say hello, I'm happy to hear back and appreciate feedback! Use the contact options in the section below and let's get in touch.</p>

<blockquote class="twitter-tweet" data-lang="de"><p lang="en" dir="ltr">Just released clue/reactphp-soap v1.0.0! ðŸŽ‰ Because soap is still a thing (sorry). Long-awaited API overhaul to efficiently send large number of async SOAP requests with <a href="https://twitter.com/reactphp?ref_src=twsrc%5Etfw">@ReactPHP</a>. <a href="https://twitter.com/hashtag/async?src=hash&amp;ref_src=twsrc%5Etfw">#async</a> <a href="https://twitter.com/hashtag/php?src=hash&amp;ref_src=twsrc%5Etfw">#php</a> <a href="https://twitter.com/hashtag/soap?src=hash&amp;ref_src=twsrc%5Etfw">#soap</a> <a href="https://t.co/f7Cvj4h3wC">https://t.co/f7Cvj4h3wC</a></p>&mdash; Christian LÃ¼ck (@another_clue) <a href="https://twitter.com/another_clue/status/1060267451915665408?ref_src=twsrc%5Etfw">7. November 2018</a></blockquote>

<p>Once again I'd like to thank <a href="https://www.bergfreunde.de/">Bergfreunde GmbH</a>, a German-based online retailer for Outdoor Gear &amp; Clothing, for sponsoring large parts of this development! ðŸŽ‰ Thanks to sponsors like this, who understand the importance of open source development, I can justify spending time and focus on open source development instead of traditional paid work.</p>

<blockquote>
  <p>Did you know that I offer custom development services and issuing invoices for sponsorships of releases and for contributions? Contact me (@clue) for details.</p>
</blockquote>
            </article>
        </div>
    </section>

    <section id="calendly">
        <div class="bg-white">
            <div class="max-w-5xl mx-auto py-16 px-4 sm:px-6 lg:px-8">
                <div class="bg-gray-800 rounded-lg shadow-xl overflow-hidden lg:grid lg:grid-cols-2 lg:gap-4">
                    <div class="pt-10 pb-12 px-6 sm:pt-16 sm:px-16 lg:py-16 lg:pr-0 xl:py-10 xl:px-10">
                        <div class="lg:self-center">
                            <h2 class="text-3xl font-extrabold text-white sm:text-4xl">
                                <span class="block">We're Here to Help!</span>
                                <span class="block text-blue-400">Let's Tackle Your Problems Together.</span>
                            </h2>
                            <p class="mt-4 text-lg leading-6 text-gray-200">
                                Did you know we provide <a href="https://clue.engineering/support" class="underline">professional support</a> for software projects?
                                Book an appointment, you pay absolutely nothing for the first consultation.
                            </p>
                            <a href="https://calendly.com/clue-engineering/getting-started" class="mt-8 bg-blue-400 hover:bg-blue-500 border border-transparent rounded-md shadow px-5 py-3 inline-flex items-center text-base font-medium text-white">Set Up a Free Call</a>
                        </div>
                    </div>
                    <div class="-mt-6 aspect-w-5 aspect-h-3 md:aspect-w-2 md:aspect-h-1">
                        <a href="https://calendly.com/clue-engineering/getting-started">
                            <img class="transform translate-x-16 translate-y-6 rounded-md object-cover object-left-top sm:translate-x-24 lg:translate-y-24 lg:translate-x-16" src="../src/2023-calendly.png" alt="calendly screenshot">
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="share">
        <div class="container">
            <h3>
                <a href="#share"></a>
                We love feedback!
            </h3>
            <p>
                If you have anything to add,
                send a tweet to <a href="https://twitter.com/another_clue">@another_clue</a>.
            </p>
            <p>
                We invite you to share our blog posts with friends and colleagues.
                All our blog posts can be shared freely under the permissive
                <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY</a>
                license.
            </p>
            <p>
                <!-- Thank you! https://fontawesome.com/ (solid/envelope) -->
                <svg viewBox="0 0 512 512"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></svg>
                <a href="../contact">Email us</a> if you think we should be working together on interesting projects.
            </p>
        </div>
    </section>

    <footer class="bg-gray-800">
      <div class="max-w-7xl mx-auto py-12 px-4 overflow-hidden sm:px-6 lg:px-8">
        <nav class="-mx-5 -my-2 flex flex-wrap justify-center" aria-label="Footer">
          <div class="px-5 py-2">
            <a href="../" class="text-base text-gray-400 hover:text-gray-300">
              Home
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="../support" class="text-base text-gray-400 hover:text-gray-300">
              Services
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="../blog" class="text-base text-gray-400 hover:text-gray-300">
              Blog
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="../talks" class="text-base text-gray-400 hover:text-gray-300">
              Talks
            </a>
          </div>

          <div class="px-5 py-2">
            <a href="../contact" class="text-base text-gray-400 hover:text-gray-300">
              Contact
            </a>
          </div>


          <div class="px-5 py-2">
            <a href="../contact#imprint" class="text-base text-gray-400 hover:text-gray-300">
              Imprint
            </a>
          </div>
        </nav>
        <div class="mt-8 flex justify-center space-x-6">
          <a href="https://twitter.com/another_clue" title="@another_clue on Twitter" class="text-gray-400 hover:text-gray-300">
            <span class="sr-only">Twitter</span>
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" />
            </svg>
          </a>
    
          <a href="https://github.com/clue" title="@clue on GitHub" class="text-gray-400 hover:text-gray-300">
            <span class="sr-only">GitHub</span>
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
            </svg>
          </a>
        </div>
      </div>
    </footer>
</body>
</html>
